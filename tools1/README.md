# Toolsç›®å½•è¯´æ˜

ç‚¹äº‘æ•°æ®å¤„ç†å·¥å…·é›†ã€‚

## ğŸ¯ ä¸¤ç§H5æ ¼å¼

| æ ¼å¼ | ç‰¹ç‚¹ | é€‚ç”¨åœºæ™¯ |
|------|------|---------|
| **å¿«é€Ÿæ ¼å¼** ğŸš€ | è¿ç»­å­˜å‚¨ï¼Œè¯»å–å¿«433-3630å€ | **å¤§è§„æ¨¡è®­ç»ƒï¼ˆæ¨èï¼‰** |
| æ ‡å‡†æ ¼å¼ | å…¨å±€æ•°ç»„+ç´¢å¼•ï¼Œæ–‡ä»¶æ›´å° | å­˜å‚¨å½’æ¡£ |

è¯¦ç»†å¯¹æ¯”ï¼š[H5_FORMAT_COMPARISON.md](H5_FORMAT_COMPARISON.md)

## ğŸ“ æ–‡ä»¶æ¸…å•

### ğŸ”¥ å¿«é€Ÿæ ¼å¼å·¥å…·ï¼ˆæ¨èç”¨äºè®­ç»ƒï¼‰

| æ–‡ä»¶ | ç”¨é€” | æ€§èƒ½ |
|------|------|------|
| **`tile_h5_fast_parallel.py`** | LASâ†’å¿«é€ŸH5ï¼ˆå¹¶è¡Œï¼‰ | **34ç§’/19æ–‡ä»¶** |
| **`h5_dataset_fast.py`** | å¿«é€ŸH5 Datasetç±» | **650-5445 seg/s** |
| **`h5_fast_to_las.py`** | å¿«é€ŸH5â†’LAS | 36 seg/s |
| `benchmark_fast_h5_full.py` | å®Œæ•´æ€§èƒ½æµ‹è¯• | - |

### ğŸ“¦ æ ‡å‡†æ ¼å¼å·¥å…·

| æ–‡ä»¶ | ç”¨é€” | æ€§èƒ½ |
|------|------|------|
| **`tile_h5.py`** | LASâ†’æ ‡å‡†H5ï¼ˆå¹¶è¡Œï¼‰ | 60ç§’/20æ–‡ä»¶ |
| **`h5_dataset.py`** | æ ‡å‡†H5 Datasetç±» | 1.5-900 seg/s |
| **`h5_to_las_parallel.py`** | æ ‡å‡†H5â†’LAS | 10-40 seg/s |
| `multi_h5_dataset.py` | å¤šæ–‡ä»¶Dataset | - |
| `h5_to_las.py` | H5â†’LASï¼ˆä¸²è¡Œï¼‰ | 2 seg/s |
| `benchmark_h5_reading.py` | æ€§èƒ½æµ‹è¯• | - |

### ğŸ“š æ–‡æ¡£

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| **`H5_FORMAT_COMPARISON.md`** | ä¸¤ç§æ ¼å¼å¯¹æ¯”ï¼ˆå¿…è¯»ï¼‰ |
| **`H5_TOOLS_GUIDE.md`** | å®Œæ•´ä½¿ç”¨æŒ‡å— |
| `H5_FILE_FORMAT.md` | æ ‡å‡†H5æ ¼å¼è¯¦è§£ |
| `MULTI_H5_GUIDE.md` | å¤šæ–‡ä»¶å¤„ç†æŒ‡å— |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼1ï¼šå¿«é€Ÿæ ¼å¼ï¼ˆæ¨èç”¨äºè®­ç»ƒï¼‰

```bash
# 1. ç”Ÿæˆå¿«é€ŸH5
python tools/tile_h5_fast_parallel.py

# é…ç½®ï¼ˆç¼–è¾‘tile_h5_fast_parallel.pyæœ«å°¾ï¼‰:
input_path = "path/to/las"
output_dir = "path/to/h5_fast"
window_size = (150., 150.)
n_workers = 8  # å¹¶è¡Œè¿›ç¨‹æ•°
```

```python
# 2. è®­ç»ƒ
from tools.h5_dataset_fast import FastMultiH5Dataset, collate_fn
from torch.utils.data import DataLoader

# åˆ›å»ºæ•°æ®é›†ï¼ˆå…¨é¢„åŠ è½½ï¼Œæè‡´é€Ÿåº¦ï¼‰
dataset = FastMultiH5Dataset(
    h5_files,
    preload_strategy="all"  # 5445 seg/s
)

# DataLoader
dataloader = DataLoader(
    dataset, 
    batch_size=16,
    shuffle=True,
    num_workers=0,  # é¢„åŠ è½½ç”¨å•çº¿ç¨‹
    collate_fn=collate_fn
)

# è®­ç»ƒå¾ªç¯
for batch_xyz, batch_labels in dataloader:
    # batch_xyz: List[Tensor[N_i, 3]]
    # batch_labels: List[Tensor[N_i]]
    ...
```

```bash
# 3. å¯è§†åŒ–éªŒè¯
python tools/h5_fast_to_las.py file.h5 --segments 0-9 --workers 4
# åœ¨CloudCompareä¸­æŸ¥çœ‹
```

### æ–¹å¼2ï¼šæ ‡å‡†æ ¼å¼ï¼ˆç”¨äºå½’æ¡£ï¼‰

```bash
# 1. ç”Ÿæˆæ ‡å‡†H5
python tools/tile_h5.py

# 2. è®­ç»ƒï¼ˆä½¿ç”¨h5_dataset.pyï¼‰
# 3. è½¬æ¢ï¼ˆä½¿ç”¨h5_to_las_parallel.pyï¼‰
```

## ğŸ“Š æ€§èƒ½å¯¹æ¯”ï¼ˆ19æ–‡ä»¶ï¼Œ4931 segmentsï¼Œ3.59äº¿ç‚¹ï¼‰

### ç”Ÿæˆé€Ÿåº¦
| æ ¼å¼ | å·¥å…· | é€Ÿåº¦ | æ–‡ä»¶å¤§å° |
|------|------|------|---------|
| å¿«é€Ÿæ ¼å¼ ğŸ”¥ | tile_h5_fast_parallel.py | **34ç§’** | 500MB/æ–‡ä»¶ |
| æ ‡å‡†æ ¼å¼ | tile_h5.py | 60ç§’ | 350MB/æ–‡ä»¶ |

### è¯»å–é€Ÿåº¦ï¼ˆè®­ç»ƒï¼‰
| æ ¼å¼ | æ¨¡å¼ | é€Ÿåº¦ | æå‡ |
|------|------|------|------|
| å¿«é€Ÿæ ¼å¼ ğŸ”¥ | é¢„åŠ è½½ | **5445 seg/s** | **3630x** |
| å¿«é€Ÿæ ¼å¼ ğŸ”¥ | æŒ‰éœ€ | **650 seg/s** | **433x** |
| æ ‡å‡†æ ¼å¼ | é¢„åŠ è½½ | 900 seg/s | 600x |
| æ ‡å‡†æ ¼å¼ | æŒ‰éœ€ | 1.5 seg/s | 1x (åŸºå‡†) |

### H5â†’LASè½¬æ¢
| å·¥å…· | é€Ÿåº¦ |
|------|------|
| h5_fast_to_las.py (å¹¶è¡Œ) | 36 seg/s |
| h5_to_las_parallel.py (å¹¶è¡Œ) | 10-40 seg/s |
| h5_to_las.py (ä¸²è¡Œ) | 2 seg/s |

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: åº”è¯¥ç”¨å“ªç§æ ¼å¼ï¼Ÿ
A: **è®­ç»ƒç”¨å¿«é€Ÿæ ¼å¼**ï¼ˆ433-3630å€æå‡ï¼‰ï¼Œå½’æ¡£ç”¨æ ‡å‡†æ ¼å¼ï¼ˆæ–‡ä»¶æ›´å°ï¼‰

### Q: å¿«é€Ÿæ ¼å¼è¯»å–çœŸçš„æœ‰é‚£ä¹ˆå¿«å—ï¼Ÿ
A: æ˜¯çš„ï¼å®æµ‹4931ä¸ªsegmentså…¨éƒ¨è¯»å®Œåªéœ€0.9ç§’ï¼ˆé¢„åŠ è½½ï¼‰æˆ–7.6ç§’ï¼ˆæŒ‰éœ€ï¼‰

### Q: å¿«é€Ÿæ ¼å¼éœ€è¦å¤šå°‘å†…å­˜ï¼Ÿ
A: 19ä¸ªæ–‡ä»¶çº¦10GBã€‚64GBå†…å­˜å¯ä»¥å…¨é¢„åŠ è½½ï¼Œ32GBå¯ç”¨éƒ¨åˆ†é¢„åŠ è½½

### Q: å†…å­˜ä¸å¤Ÿç”¨æ€ä¹ˆåŠï¼Ÿ
A: å¿«é€Ÿæ ¼å¼çš„æŒ‰éœ€åŠ è½½ä¹Ÿæœ‰650 seg/sï¼ˆæ˜¯æ ‡å‡†æ ¼å¼çš„433å€ï¼‰

### Q: æ€ä¹ˆå¯è§†åŒ–H5æ–‡ä»¶ï¼Ÿ
A: 
- å¿«é€Ÿæ ¼å¼ï¼š`python h5_fast_to_las.py file.h5 --workers 4`
- æ ‡å‡†æ ¼å¼ï¼š`python h5_to_las_parallel.py file.h5 --workers 8`

### Q: ä¸ºä»€ä¹ˆé¢„åŠ è½½è¦ç”¨num_workers=0ï¼Ÿ
A: æ•°æ®å·²åœ¨å†…å­˜ï¼Œå¤šè¿›ç¨‹ä¼šå¢åŠ åºåˆ—åŒ–å¼€é”€ï¼Œåè€Œæ›´æ…¢

### Q: èƒ½å¦äº’ç›¸è½¬æ¢ï¼Ÿ
A: å¯ä»¥é€šè¿‡LASä¸­è½¬ï¼Œä½†æ¨èç›´æ¥é‡æ–°ç”Ÿæˆ

## ğŸ“– è¯¦ç»†æ–‡æ¡£

æ‰€æœ‰å·¥å…·çš„è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹ï¼š**`H5_TOOLS_GUIDE.md`**
